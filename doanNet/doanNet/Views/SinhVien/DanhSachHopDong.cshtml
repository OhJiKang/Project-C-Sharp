
@{
    ViewBag.Title = "DanhSachHopDong";
    Layout = "~/Views/Shared/layoutteacher.cshtml";
}
<script src="https://code.jquery.com/jquery-3.7.1.js" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/2.0.3/js/dataTables.js" crossorigin="anonymous"></script>

<link rel="stylesheet" type="text/css" href="~/Areas/admin/Content/CSS/GiaoVien.css">
@Scripts.Render("~/Areas/admin/Content/Script/JSAPI/SinhVienAPI.js")
@Scripts.Render("~/Areas/admin/Content/Script/JSAPI/RoomAPI.js")
@Scripts.Render("~/Areas/admin/Content/Script/JSAPI/ContractAPI.js")
@Scripts.Render("~/Areas/admin/Content/Script/JSAPI/PriorityAPI.js")
@Scripts.Render("~/Areas/admin/Content/Script/JSAPI/AccountAPI.js")
<div class="container">
    <div class="row">
        <div class="col-12 text-center" style="padding:20px">
            <h2 style="font-weight: bold">DANH SÁCH HỢP ĐỒNG</h2>
        </div>

    </div>
    <div class="row">
        <table class="table" id="datatableform">
            <thead>
                <tr>
                    <th scope="col">Mã hợp đồng</th>
                    <th scope="col">Họ và tên Sinh viên</th>
                    <th scope="col">Căn cước công dân</th>
                    <th scope="col">Hồ sơ đi kèm</th>
                    <th scope="col">Khu vực</th>
                    <th scope="col">Ưu tiên</th>
                    <th scope="col">Đăng ký vào lúc</th>
                    <th scope="col">Xét duyệt</th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <script>
        $(document).ready(async () => {
            function formatDateTime(datetimeString) {
                var dateTime = new Date(datetimeString);
                var formattedDate = dateTime.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });
                var formattedTime = dateTime.toLocaleTimeString('en-GB', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });

                return formattedDate + ' ';
            }
            async function renderContractByStudent(ContractDataToRender) {
                let htmls = ``
                let table = new DataTable('#datatableform');
                table.clear();

                ContractDataToRender.forEach(async (contract) => {
                    let PriorityInfo = await findPriorityById(contract.IDPriority);
                    let SinhVienInfo = await findSinhVienById(contract.IDSinhVien)

                    htmls = `
                    <tr>
                        <td>${contract.IDContract}</td>
                        <td>${SinhVienInfo.FullName}</td>
                        <td>${contract.IDCitizen}</td>
                        <td>${contract.ProfilePlace == 0 ? 'Không có' : 'Có'}</td>
                        <td>${contract.IDPlace}</td>
                        <td>${PriorityInfo.PriorityDescription}</td>
                        <td>${formatDateTime(contract.TimeExpired)}</td>
                    </tr>`;
                    table.row.add($(htmls).get(0));
                    table.draw();
                })
                console.log(MistakeDataToRender)

            };
            /*$('#datatableform').DataTable({
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ]
            });

            SELECT TOP (1000) [IDContract]
      ,[IDCitizen]
      ,[ProfilePlace]
      ,[IDPlace]
      ,[Order]
      ,[Meta]
      ,[DateBegin]
      ,[Hide]
      ,[IDPriority]
      ,[Description]
      ,[xetduyet]
      ,[TimeExpired]
      ,[IDSinhVien]
  FROM [dbo].[Contract]

            */

            if (!sessionStorage.getItem("IDAccount")) {
                window.location.href = "@Url.Action("DangNhapSinhVien", "TrangChu")"
            }
            else {
                const IDAccount = sessionStorage.getItem("IDAccount")
                let AccountInfo = await getAccountByID(IDAccount)
                const IDSinhVien = AccountInfo.IDSinhVien
                let ContractInfo = await getContractBySinhVienID(IDSinhVien);
                renderContractByStudent(ContractInfo)
            }
        })
    </script>
</div>


